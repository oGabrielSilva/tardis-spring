"use strict";(()=>{var m=(n,e,t)=>new Promise((s,a)=>{var r=l=>{try{o(t.next(l))}catch(c){a(c)}},i=l=>{try{o(t.throw(l))}catch(c){a(c)}},o=l=>l.done?s(l.value):Promise.resolve(l.value).then(r,i);o((t=t.apply(n,e)).next())});var E=class{GET(s){return m(this,arguments,function*(e,t=new Headers){let a=yield fetch(this.normalizePath(e),this.optionsWithoutBody(t,"GET"));return{json:yield this.getJson(a),response:a,status:a.status}})}POST(a,r){return m(this,arguments,function*(e,t,s=new Headers){let i=yield fetch(this.normalizePath(e),this.options(t,s,"POST"));return{json:yield this.getJson(i),response:i,status:i.status}})}normalizePath(e){return console.log(e.startsWith("/api")?e:"/api"+(e.startsWith("/")?e:e+"/")),e.startsWith("/api")?e:"/api"+(e.startsWith("/")?e:e+"/")}configureHeaders(e){return e.set("Content-Type","application/json"),e}options(e,t,s="GET"){return{body:e,headers:this.configureHeaders(t),credentials:"include",method:s}}optionsWithoutBody(e,t="GET"){return{headers:this.configureHeaders(e),credentials:"include",method:t}}getJson(e){return e.status!==204&&e.status!==205?e.json():null}};var v=class{constructor(){this.emailRegex=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/}isEmailValid(e){return typeof e=="string"&&this.emailRegex.test(e)}isPasswordValid(e){return typeof e=="string"&&e.length>=8}isNameValid(e){return typeof e=="string"&&e.length>=2}isUsernameValid(e){return typeof e=="string"&&e.length>=1}};function C(n,e,t,s,a){let r="",i=n.dataset.generic?n.dataset.generic:"Oopss...",o=n.dataset.success?n.dataset.success:"#",l=new v,c=n.querySelector("input#email"),y=c.dataset.message,u=n.querySelector("input#password"),f=u.dataset.message,h=n.querySelector('button[type="submit"]'),b=n.querySelector("#session-sign-up"),p=document.createElement("button");c.addEventListener("input",()=>{c.dataset.error=String(!l.isEmailValid(c.value.trim()))}),u.addEventListener("input",()=>{u.dataset.error=String(!l.isPasswordValid(u.value.trim()))}),h.addEventListener("click",d=>{d.preventDefault(),r="/authentication/session",p.click()}),b.addEventListener("click",()=>{r="/authentication/sign-up",p.click()}),n.addEventListener("submit",d=>{if(d.preventDefault(),!l.isEmailValid(c.value.trim())){e.shake(c),t.danger(y);return}if(!l.isPasswordValid(u.value.trim())){e.shake(u),t.danger(f);return}M()});function M(){return m(this,null,function*(){s.show();try{let d=JSON.stringify({email:c.value.trim(),password:u.value.trim()}),{json:g}=yield a.POST(r,d);if(!g){t.alert(i);return}if(!g.user){t.alert(g.message);return}t.addAfterFunction(()=>location.href="/").success(o.replace("#",g.user.username))}catch(d){console.log(d),t.alert(i)}finally{s.hide()}})}p.type="submit",p.textContent="Submit",p.classList.add("dn"),n.appendChild(p)}var R,L,x,T=new v;function V(n){let e=document.querySelector("main"),t=document.querySelector("header"),s=n.querySelector("#avatar-input"),a=n.querySelector(".avatar"),r=s.dataset.message,i="";e.style.minHeight=`calc(95vh - ${t.clientHeight}px)`,a.addEventListener("click",()=>s.click()),s.addEventListener("input",()=>m(this,null,function*(){if(!s.files||!s.files[0]){L.info(r),x.shake(a);return}let P=yield R.imageToBlob(s.files[0]);if(!P){L.info(r),x.shake(a);return}URL.revokeObjectURL(i),i=URL.createObjectURL(P),a.src=i}));let o=n.querySelector("#name"),c=o.value,y=T.isNameValid(c);o.addEventListener("input",()=>{c=o.value,y=T.isNameValid(c),o.dataset.error=String(!y)});let u=n.querySelector("#email"),h=u.value,b=T.isEmailValid(h);u.addEventListener("input",()=>{h=u.value,b=T.isEmailValid(h),u.dataset.error=String(!b)});let p=n.querySelector("#username"),d=p.value,g=T.isUsernameValid(d);p.addEventListener("input",()=>{d=p.value,g=T.isUsernameValid(d),p.dataset.error=String(!g)})}function U(n,e){R=n,L=e,x=L.getAnimator();let t=document.getElementById("edit-profile");t&&V(t)}var w=class{constructor(){this.shakeClass="animated-by-shake"}scaleIn(e,t){e.style.scale="1.1",setTimeout(()=>{e.style.scale="",t&&setTimeout(()=>t(),400)},400)}scaleOut(e,t){e.style.scale="1.1",setTimeout(()=>{e.style.scale="0",t&&setTimeout(()=>t(),400)},100)}shake(e,t=!0,s=400){e.classList.contains(this.shakeClass)&&e.classList.remove(this.shakeClass),t&&e.focus(),setTimeout(()=>{e.classList.add(this.shakeClass),setTimeout(()=>e.classList.remove(this.shakeClass),s)},100)}};var H=class{imageToBlob(e,t=128,s=128,a=!0){return new Promise(r=>{try{if(!e)return r(null);let i=URL.createObjectURL(e),o=new Image;o.onload=()=>m(this,null,function*(){let l=o.width,c=o.height,u=document.createElement("canvas").getContext("2d"),f=a&&(l<c?yield this.resizeHeight(o,l,c):l>c?yield this.resizeWidth(o,l,c):o)||o;u.canvas.width=t,u.canvas.height=s,u.drawImage(f,0,0,t,s),u.canvas.toBlob(h=>{URL.revokeObjectURL(i),r(h)},"image/jpeg",.9)}),o.crossOrigin="Anonymous",o.src=i}catch(i){r(null)}})}imageToBlobWhithoutResize(e){return new Promise(t=>{try{if(!e)return t(null);let s=URL.createObjectURL(e),a=new Image;a.onload=()=>m(this,null,function*(){let r=a.width*.8,i=a.height*.8,l=document.createElement("canvas").getContext("2d");l.canvas.width=r,l.canvas.height=i,l.drawImage(a,0,0,r,i),l.canvas.toBlob(c=>{URL.revokeObjectURL(s),t(c)},"image/jpeg",.85)}),a.crossOrigin="Anonymous",a.src=s}catch(s){t(null)}})}resizeHeight(e,t,s){return new Promise(a=>{let i=document.createElement("canvas").getContext("2d");i.canvas.width=t,i.canvas.height=t,i.drawImage(e,0,s*.2,t,t,0,0,t,t);let o=new Image;o.onload=()=>a(o),o.src=i.canvas.toDataURL()})}resizeWidth(e,t,s){return new Promise(a=>{let i=document.createElement("canvas").getContext("2d");i.canvas.width=s,i.canvas.height=s,i.drawImage(e,t*.2,0,s,s,0,0,s,s);let o=new Image;o.onload=()=>a(o),o.src=i.canvas.toDataURL()})}};function S({htmlType:n,attributes:e,onClick:t,children:s}){let a=document.createElement(n);return e&&e.forEach(r=>a.setAttribute(r.key,r.value)),t&&(a.onclick=t),s&&s.forEach(r=>{let i=S(r);a.appendChild(i)}),a}function A({attributes:n,htmlType:e,onClick:t,children:s}){let a=S({htmlType:e,attributes:n,onClick:t});return s&&s.forEach(r=>{let i=S(r);a.appendChild(i)}),a}var I=class{constructor(){this.screenProgressID="progress-view-container";this.barClassName="bar";this.bar2ClassName="bar2";this.view=A({htmlType:"div",attributes:[{key:"id",value:this.screenProgressID}],children:[{htmlType:"div",attributes:[{key:"class",value:this.barClassName}]},{htmlType:"div",attributes:[{key:"class",value:this.bar2ClassName}]}]});this.isVisible=!1}show(){this.isVisible||(this.isVisible=!0,document.body.appendChild(this.view))}hide(){this.isVisible=!1,this.view.remove()}};var k=class n{constructor(e){this.events=[];this.toasterID="toaster";this.toaster=null;this.toasterText=null;this.toasterIcon=null;this.toasterProgress=null;this.styleWithAnim=document.createElement("style");this.toasterInScreen=!1;this.animationClass="ex-anim-progress-bar";this.animationKeyframePropertyName="kf-anim-progress-bar";this.themes={info:{icon:"bi bi-info-circle",backdrop:"var(--primary)",color:"var(--text-on-primary)"},danger:{icon:"bi bi-exclamation-diamond",backdrop:"var(--danger)",color:"var(--text-on-danger)"},alert:{icon:"bi bi-question-diamond",backdrop:"var(--alert)",color:"var(--text-on-alert)"},success:{icon:"bi bi-check2-circle",backdrop:"var(--success)",color:"var(--text-on-success)"}};this.afterFunction=void 0;this.anim=e}generate(){this.toaster=A({htmlType:"div",attributes:[{key:"id",value:this.toasterID}],children:[{htmlType:"div",attributes:[{key:"class",value:"content"}],children:[{htmlType:"i",attributes:[{key:"class",value:"bi bi-info-circle"}]},{htmlType:"span"}]},{htmlType:"div",attributes:[{key:"class",value:"progress "+this.animationClass}]}]}),this.toasterText=this.toaster.querySelector("span"),this.toasterIcon=this.toaster.querySelector("i"),this.toasterProgress=this.toaster.querySelector(".progress"),document.head.appendChild(this.styleWithAnim),this.toaster.onclick=()=>{this.hide()}}updateStyle(e){this.styleWithAnim.innerHTML=`
    .${this.animationClass} {
      animation: ${this.animationKeyframePropertyName} ${e}ms ease;
    }

    @keyframes ${this.animationKeyframePropertyName} {
      to {
        transform: translateX(-100%);
      }
    }
    `}updateTheme({backdrop:e,color:t,icon:s}){var a,r,i;this.toasterIcon.className=s,(a=this.toaster)==null||a.style.setProperty("background",e),(r=this.toasterIcon)==null||r.style.setProperty("color",t),(i=this.toasterText)==null||i.style.setProperty("color",t)}show(e){if(this.toasterInScreen){this.hide().then(()=>this.show(e));return}this.toaster.style.scale="0",this.toasterInScreen=!0,this.toasterProgress.style.transform="",document.body.appendChild(this.toaster),this.events.push(setTimeout(()=>this.anim.scaleIn(this.toaster),100)),this.events.push(setTimeout(()=>this.toasterProgress.style.transform="translateX(-100%)",e-10))}hide(){return m(this,null,function*(){return new Promise(e=>{try{this.events.forEach(t=>clearTimeout(t)),this.anim.scaleOut(this.toaster,()=>{var t;(t=this.toaster)==null||t.remove(),this.toasterInScreen=!1,e(!0)})}catch(t){console.error(t),e(!1)}finally{typeof this.afterFunction=="function"&&this.afterFunction(),this.afterFunction=void 0}})})}addAfterFunction(e){return this.afterFunction=e,this}info(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.info),this.toasterText.textContent=e,this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}alert(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.alert),this.toasterText.textContent=e,this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}success(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.success),this.toasterText.textContent=e,this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}danger(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.danger),this.toasterText.textContent=e,this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}getAnimator(){return this.anim}static create(e){let t=new n(e);return t.generate(),t}};(()=>{let n=document.getElementById("www-manager-id");if(!n)return console.error("Manager ID is not defined");let e=new w,t=k.create(e),s=new I,a=new E,r=new H;switch(n.value){case"session":C(document.getElementById("session"),e,t,s,a);break;case"profile":U(r,t);break;default:break}})();})();
//# sourceMappingURL=dist.min.js.map
