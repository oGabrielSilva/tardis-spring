"use strict";(()=>{var T=(s,e,t)=>new Promise((i,a)=>{var r=d=>{try{o(t.next(d))}catch(c){a(c)}},n=d=>{try{o(t.throw(d))}catch(c){a(c)}},o=d=>d.done?i(d.value):Promise.resolve(d.value).then(r,n);o((t=t.apply(s,e)).next())});var V=class s{constructor(){}GET(i){return T(this,arguments,function*(e,t=new Headers){let a=yield fetch(this.normalizePath(e),this.optionsWithoutBody(t,"GET"));return{json:yield this.getJson(a),response:a,status:a.status}})}POST(a,r){return T(this,arguments,function*(e,t,i=new Headers){let n=yield fetch(this.normalizePath(e),this.options(t,i,"POST"));return{json:yield this.getJson(n),response:n,status:n.status}})}PUT(a,r){return T(this,arguments,function*(e,t,i=new Headers){let n=yield fetch(this.normalizePath(e),this.options(t,i,"PUT"));return{json:yield this.getJson(n),response:n,status:n.status}})}PATCH(a,r){return T(this,arguments,function*(e,t,i=new Headers){let n=yield fetch(this.normalizePath(e),this.options(t,i,"PATCH"));return{json:yield this.getJson(n),response:n,status:n.status}})}DELETE(i){return T(this,arguments,function*(e,t=new Headers){let a=yield fetch(this.normalizePath(e),this.optionsWithoutBody(t,"DELETE"));if(!a.ok){let r=yield this.getJson(a);return{response:a,status:a.status,json:r}}return{response:a,status:a.status}})}normalizePath(e){return e.startsWith("/api")?e:"/api"+(e.startsWith("/")?e:e+"/")}configureHeaders(e){return e.set("Content-Type","application/json"),e}options(e,t,i="GET"){return{body:e,headers:this.configureHeaders(t),credentials:"include",method:i}}optionsWithoutBody(e,t="GET"){return{headers:this.configureHeaders(e),credentials:"include",method:t}}getJson(e){return e.status!==204&&e.status!==205?e.json():null}static get(){return s.rest||(s.rest=new s),s.rest}};var G=class{constructor(){this.emailRegex=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;this.usernameRegex=/[^a-zA-Z0-9\-_.]/g}isEmailValid(e){return typeof e=="string"&&this.emailRegex.test(e)}isPasswordValid(e){return typeof e=="string"&&e.length>=8}isNameValid(e){return typeof e=="string"&&e.length>=2}isUsernameValid(e){return typeof e=="string"&&e.length>=1}normalizeUsername(e){return e.trim().replace(this.usernameRegex,"")}};var P=class s{constructor(){this.shakeClass="animated-by-shake"}scaleIn(e,t){e.style.scale="1.1",setTimeout(()=>{e.style.scale="",t&&setTimeout(()=>t(),400)},400)}scaleOut(e,t){e.style.scale="1.1",setTimeout(()=>{e.style.scale="0",t&&setTimeout(()=>t(),400)},100)}shake(e,t=!0,i=400){e.classList.contains(this.shakeClass)&&e.classList.remove(this.shakeClass),t&&e.focus(),setTimeout(()=>{e.classList.add(this.shakeClass),setTimeout(()=>e.classList.remove(this.shakeClass),i)},100)}static get(){return s.anim||(s.anim=new s),s.anim}};function re({htmlType:s,attributes:e,value:t,onClick:i,children:a}){let r=document.createElement(s);return e&&e.forEach(n=>r.setAttribute(n.key,n.value)),i&&(r.onclick=()=>i(r)),a&&a.forEach(n=>{let o=re(n);r.appendChild(o)}),t&&(r.textContent=t),r}function $({attributes:s,value:e,htmlType:t,onClick:i,children:a}){let r=re({htmlType:t,attributes:s,onClick:i});return a&&a.forEach(n=>{let o=re(n);r.appendChild(o)}),e&&(r.textContent=e),r}var x=class s{constructor(){this.screenProgressID="progress-view-container";this.barClassName="bar";this.bar2ClassName="bar2";this.view=$({htmlType:"div",attributes:[{key:"id",value:this.screenProgressID}],children:[{htmlType:"div",attributes:[{key:"class",value:this.barClassName}]},{htmlType:"div",attributes:[{key:"class",value:this.bar2ClassName}]}]});this.isVisible=!1}show(){this.isVisible||(this.isVisible=!0,document.body.appendChild(this.view))}hide(){this.isVisible=!1,this.view.remove()}onScreen(){return this.isVisible}static get(){return s.tool||(s.tool=new s),s.tool}};var I=class s{constructor(e){this.events=[];this.toasterID="toaster";this.toaster=null;this.toasterText=null;this.toasterIcon=null;this.toasterProgress=null;this.styleWithAnim=document.createElement("style");this.toasterInScreen=!1;this.animationClass="ex-anim-progress-bar";this.animationKeyframePropertyName="kf-anim-progress-bar";this.themes={info:{icon:"bi bi-info-circle",backdrop:"var(--primary)",color:"var(--text-on-primary)"},danger:{icon:"bi bi-exclamation-diamond",backdrop:"var(--danger)",color:"var(--text-on-danger)"},alert:{icon:"bi bi-question-diamond",backdrop:"var(--alert)",color:"var(--text-on-alert)"},success:{icon:"bi bi-check2-circle",backdrop:"var(--success)",color:"var(--text-on-success)"}};this.afterFunction=void 0;this.anim=e}generate(){this.toaster=$({htmlType:"div",attributes:[{key:"id",value:this.toasterID}],children:[{htmlType:"div",attributes:[{key:"class",value:"content"}],children:[{htmlType:"i",attributes:[{key:"class",value:"bi bi-info-circle"}]},{htmlType:"span"}]},{htmlType:"div",attributes:[{key:"class",value:"progress "+this.animationClass}]}]}),this.toasterText=this.toaster.querySelector("span"),this.toasterIcon=this.toaster.querySelector("i"),this.toasterProgress=this.toaster.querySelector(".progress"),document.head.appendChild(this.styleWithAnim),this.toaster.onclick=()=>{this.hide()}}updateStyle(e){this.styleWithAnim.innerHTML=`
    .${this.animationClass} {
      animation: ${this.animationKeyframePropertyName} ${e}ms ease;
    }

    @keyframes ${this.animationKeyframePropertyName} {
      to {
        transform: translateX(-100%);
      }
    }
    `}updateTheme({backdrop:e,color:t,icon:i}){var a,r,n;this.toasterIcon.className=i,(a=this.toaster)==null||a.style.setProperty("background",e),(r=this.toasterIcon)==null||r.style.setProperty("color",t),(n=this.toasterText)==null||n.style.setProperty("color",t)}show(e){if(this.toasterInScreen){this.hide().then(()=>this.show(e));return}this.toaster.style.scale="0",this.toasterInScreen=!0,this.toasterProgress.style.transform="",document.body.appendChild(this.toaster),this.events.push(setTimeout(()=>this.anim.scaleIn(this.toaster),100)),this.events.push(setTimeout(()=>this.toasterProgress.style.transform="translateX(-100%)",e-10))}hide(){return T(this,null,function*(){return new Promise(e=>{try{this.events.forEach(t=>clearTimeout(t)),this.anim.scaleOut(this.toaster,()=>{var t;(t=this.toaster)==null||t.remove(),this.toasterInScreen=!1,e(!0)})}catch(t){console.error(t),e(!1)}finally{typeof this.afterFunction=="function"&&this.afterFunction(),this.afterFunction=void 0}})})}addAfterFunction(e){return this.afterFunction=e,this}info(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.info),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}alert(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.alert),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}success(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.success),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}danger(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.danger),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}getAnimator(){return this.anim}static get(e){return s.tool||(e||(e=P.get()),s.tool=new s(e),s.tool.generate()),s.tool}};var oe=P.get(),N=I.get(),le=x.get(),ge=V.get();function ce(s){var v;let e="",t=s.dataset.generic?s.dataset.generic:"Oopss...",i=s.dataset.success?s.dataset.success:"#",a=new G,r=s.querySelector("input#email"),n=r.dataset.message,o=s.querySelector("input#password"),d=o.dataset.message,c=s.querySelector('button[type="submit"]'),g=s.querySelector("#session-sign-up"),u=document.createElement("button");new URLSearchParams(location.search).get("clear")==="true"&&N.danger((v=s.dataset.forbidden)!=null?v:""),r.addEventListener("input",()=>{r.dataset.error=String(!a.isEmailValid(r.value.trim()))}),o.addEventListener("input",()=>{o.dataset.error=String(!a.isPasswordValid(o.value.trim()))}),c.addEventListener("click",f=>{f.preventDefault(),e="/authentication/session",u.click()}),g.addEventListener("click",()=>{e="/authentication/sign-up",u.click()}),s.addEventListener("submit",f=>{if(f.preventDefault(),!a.isEmailValid(r.value.trim())){oe.shake(r),N.danger(n);return}if(!a.isPasswordValid(o.value.trim())){oe.shake(o),N.danger(d);return}h()});function h(){return T(this,null,function*(){le.show();try{let f=JSON.stringify({email:r.value.trim(),password:o.value.trim()}),{json:L}=yield ge.POST(e,f);if(!L){N.alert(t);return}if(!L.user){N.alert(L.message);return}N.addAfterFunction(()=>{new URLSearchParams(location.search).get("clear")==="true"?window.close():window.location.href="/"}).success(i.replace("#",L.user.username))}catch(f){console.log(f),N.alert(t)}finally{le.hide()}})}u.type="submit",u.textContent="Submit",u.classList.add("dn"),s.appendChild(u)}var U=class s{constructor(){}imageToBlob(e,t=128,i=128,a=!0){return new Promise(r=>{try{if(!e)return r(null);let n=URL.createObjectURL(e),o=new Image;o.onload=()=>T(this,null,function*(){let d=o.width,c=o.height,u=document.createElement("canvas").getContext("2d"),h=a&&(d<c?yield this.resizeHeight(o,d,c):d>c?yield this.resizeWidth(o,d,c):o)||o;u.canvas.width=t,u.canvas.height=i,u.drawImage(h,0,0,t,i),u.canvas.toBlob(v=>{URL.revokeObjectURL(n),r(v)},"image/jpeg",.9)}),o.crossOrigin="Anonymous",o.src=n}catch(n){r(null)}})}imageToBlobWhithoutResize(e,t=.85){return(t>1||t<0)&&(t=1),new Promise(i=>{try{if(!e)return i(null);let a=URL.createObjectURL(e),r=new Image;r.onload=()=>T(this,null,function*(){let n=r.width*.8,o=r.height*.8,c=document.createElement("canvas").getContext("2d");c.canvas.width=n,c.canvas.height=o,c.drawImage(r,0,0,n,o),c.canvas.toBlob(g=>{URL.revokeObjectURL(a),i(g)},"image/jpeg",t)}),r.crossOrigin="Anonymous",r.src=a}catch(a){i(null)}})}resizeHeight(e,t,i){return new Promise(a=>{let n=document.createElement("canvas").getContext("2d");n.canvas.width=t,n.canvas.height=t,n.drawImage(e,0,i*.2,t,t,0,0,t,t);let o=new Image;o.onload=()=>a(o),o.src=n.canvas.toDataURL()})}resizeWidth(e,t,i){return new Promise(a=>{let n=document.createElement("canvas").getContext("2d");n.canvas.width=i,n.canvas.height=i,n.drawImage(e,t*.2,0,i,i,0,0,i,i);let o=new Image;o.onload=()=>a(o),o.src=n.canvas.toDataURL()})}static get(){return s.tool||(s.tool=new s),s.tool}};var ve=U.get(),k=I.get(),R=P.get(),z=x.get(),ie=V.get(),q=new G;function ye(s){let e=s.dataset.auth,t=document.querySelector("main"),i=document.querySelector("header"),a=s.querySelector("#avatar-input"),r=s.querySelector(".avatar"),n=document.querySelector("header").querySelector(".avatar"),o=a.dataset.message,d=s.querySelector("#span-user-name"),c=s.querySelector(".modal"),g=c.querySelector("button.danger"),u=c.querySelector("button.primary"),h="";t.style.minHeight=`calc(95vh - ${i.clientHeight}px)`,r.addEventListener("click",()=>a.click()),a.addEventListener("input",()=>T(this,null,function*(){z.show();try{if(!a.files||!a.files[0]){k.info(o),R.shake(r);return}let p=yield ve.imageToBlob(a.files[0]);if(!p){k.info(o),R.shake(r);return}let y=new FormData;y.set("avatar",p);let E=yield fetch("/api/authentication/user/avatar",{method:"PATCH",body:y,credentials:"include"}),w=yield E.json();E.ok?k.success(w.message):k.danger(w.message),URL.revokeObjectURL(h),h=URL.createObjectURL(p),r.src=h,n.src=h}catch(p){console.log(p)}finally{z.hide()}}));let v=c.querySelector("#password"),f=v.value.trim(),L=q.isPasswordValid(f);v.addEventListener("input",()=>{f=v.value.trim(),L=q.isPasswordValid(f),v.dataset.error=String(!L)});let l=s.querySelector("#name"),H=l.value.trim(),_=q.isNameValid(H);l.addEventListener("input",()=>{H=l.value.trim(),_=q.isNameValid(H),l.dataset.error=String(!_)});let j=s.querySelector("#email"),ee=j.value.trim(),O=ee,F=q.isEmailValid(O);j.addEventListener("input",()=>{O=j.value.trim(),F=q.isEmailValid(O),j.dataset.error=String(!F)});let D=s.querySelector("#username"),W=D.dataset.usernameAlreadyRegistered,B=D.value.trim(),J=q.isUsernameValid(B);D.addEventListener("input",()=>{D.value=q.normalizeUsername(D.value),B=D.value.trim(),J=q.isUsernameValid(B),D.dataset.error=String(!J)}),s.addEventListener("submit",p=>T(this,null,function*(){if(p.preventDefault(),z.show(),!J){k.alert(l.dataset.message);return}if(!F){k.alert(j.dataset.message);return}if(!_){k.alert(l.dataset.message);return}let{status:y,json:E}=yield ie.GET("user/passwordu, JSON.stringify({password, newPassword})sername/"+B);if(y===200&&(E==null?void 0:E.email)!==e&&k.info(W==null?void 0:W.replace("#",B)),ee!==O&&F){c==null||c.classList.remove("out-bottom"),z.hide();return}m()}));function m(p=!1){return T(this,null,function*(){try{let y=p?{email:O,password:f,name:H,username:B}:{name:H,username:B},{json:E,status:w}=yield ie.PUT("/authentication/user",JSON.stringify(y));if(w===200)return k.success(s.dataset.success),d.textContent=E.name,history.pushState(null,"","/u/"+E.username);k.danger(E.message),console.log(E)}catch(y){k.danger("Oopsss..."),console.log(y)}finally{z.hide()}})}g==null||g.addEventListener("click",()=>c.classList.add("out-bottom")),u==null||u.addEventListener("click",()=>{if(!L){k.alert(v.dataset.message),R.shake(v);return}z.show(),m(!0)})}function fe(s,e){e.addEventListener("click",()=>s.classList.remove("out-left"));let t=s.querySelector("button.danger"),i=s.querySelector("form"),a=s.querySelector("#c-password"),r=a.value.trim(),n=q.isPasswordValid(r);a.addEventListener("input",()=>{r=a.value.trim(),n=q.isPasswordValid(r),a.dataset.error=String(!n)});let o=()=>{h=u.value.trim(),u.dataset.error=String(!(g&&c===h))},d=s.querySelector("#n-password"),c=d.value.trim(),g=q.isPasswordValid(c);d.addEventListener("input",()=>{c=d.value.trim(),g=q.isPasswordValid(c),d.dataset.error=String(!g),o()});let u=s.querySelector("#c-n-password"),h=u.value.trim();u.addEventListener("input",o),t==null||t.addEventListener("click",()=>{s.classList.add("out-left")}),i.addEventListener("submit",v=>T(this,null,function*(){v.preventDefault(),z.show();try{if(!n){k.danger(a.dataset.message),R.shake(a);return}if(!g){k.danger(d.dataset.message),R.shake(d);return}if(h!==c){k.danger(u.dataset.message),R.shake(u);return}if(h===r){k.danger(u.dataset.messageEqual),R.shake(u),R.shake(d),R.shake(a);return}let{json:f,status:L}=yield ie.PATCH("/authentication/user/password",JSON.stringify({password:r,newPassword:c}));if(L===204){a.value="",r="",c="",d.value="",h="",u.value="",t==null||t.click(),k.success(i.dataset.success);return}k.danger(f.message)}catch(f){console.log(f)}finally{z.hide()}}))}function ue(){let s=document.getElementById("edit-profile");s&&(ye(s),fe(document.getElementById("modal-password"),document.getElementById("button-update-password")))}var Z=class{constructor(){this.keywordsRegex=/[^a-zA-Z0-9,_\-@#!%&?*\s]/g}isTitleValid(e){return typeof e=="string"&&e.length>=5}catchKeywords(e){return e?this.normalizeKeywords(e).replace(/,/g," ").split(" ").filter(t=>t.length>=1):[]}normalizeKeywords(e){return typeof e=="string"?e.replace(this.keywordsRegex,"").toLocaleLowerCase():""}isQuestTitleValid(e){return typeof e=="string"&&e.length<=150&&e.length>=5}normalizeQuestTitle(e){return typeof e=="string"?e.replace(/\r\n|\r|\n/g,""):""}};var te=x.get(),Te=U.get(),se=new Z,ae=P.get(),X=I.get(ae);function de(s){let e=s.querySelector("#btn-add-f-img"),t=s.querySelector('input[type="file"]'),i=s.querySelector("#image-preview"),a="",r;e.addEventListener("click",()=>t.click()),i.addEventListener("click",()=>t.click()),t.addEventListener("input",()=>{te.show(),setTimeout(()=>T(this,null,function*(){try{if(!t.files||!t.files[0])return;let l=yield Te.imageToBlobWhithoutResize(t.files[0]);if(!l)return X.alert("Oopss...");if(l.size>1024e3){console.log(l.size),X.danger(t.dataset.message);return}URL.revokeObjectURL(a),a=URL.createObjectURL(l),i.src=a,r=l,i.classList.contains("dn")&&(i.classList.remove("dn"),e.classList.add("dn"))}catch(l){console.log(l)}finally{te.hide()}}),500)});let n=s.querySelector("#title"),o=n.value,d=se.isTitleValid(o);n.addEventListener("input",()=>{o=n.value,d=se.isTitleValid(o)});let c=s.querySelector("#description"),g=s.querySelector("#description-len"),u=c.value;g.textContent=(350-u.length).toString(),c.addEventListener("input",()=>{u=c.value,g.textContent=(350-u.length).toString()});let h=s.querySelector("#keywords"),v=s.querySelector("#preview-keywords"),f=se.catchKeywords(h.value);h.addEventListener("input",()=>{f=se.catchKeywords(h.value),v.innerHTML="",f.forEach(l=>{let b=document.createElement("span");b.textContent=l,b.title=l,v.appendChild(b)})});let L=()=>T(this,null,function*(){te.show();try{if(!r){X.alert(e.dataset.message),e.classList.contains("dn")||(e.scrollIntoView(),ae.shake(e));return}if(!d){X.alert(n.dataset.message),n.scrollIntoView(),ae.shake(n);return}if(f.length<1){X.alert(h.dataset.message),h.scrollIntoView(),ae.shake(h);return}let l=new FormData;l.set("title",o),l.set("description",u||""),l.set("keywords",f.join(",")),l.set("image",r);let b=yield fetch("/api/quiz",{body:l,credentials:"include",method:"POST"});if(console.log(b),b.status===403){window.open("/session?clear=true","_blank","focus");return}let H=yield b.json();b.ok?window.location.href=H.url:X.danger(H.message)}catch(l){console.log(l)}finally{te.hide()}});s.addEventListener("submit",l=>{l.preventDefault(),L()})}function ne(){I.get().hide(),x.get().hide(),I.get().alert("Forbidden (403)"),window.open("/session?clear=true","_blank","focus")}var A=x.get(),me=U.get(),Y=new Z,C=P.get(),S=I.get(C),Ee=V.get(),Q=typeof listOfQuests!="undefined"?listOfQuests:[];function pe(s){let e=s.querySelector('input[type="file"]'),t=s.querySelector("#image-preview"),i="",a;t.addEventListener("click",()=>e.click()),e.addEventListener("input",()=>{A.show(),setTimeout(()=>T(this,null,function*(){try{if(!e.files||!e.files[0])return;let l=yield me.imageToBlobWhithoutResize(e.files[0]);if(!l)return S.alert("Oopss...");if(l.size>1024e3){S.danger(e.dataset.message);return}URL.revokeObjectURL(i),i=URL.createObjectURL(l),t.src=i,a=l,t.classList.contains("dn")&&t.classList.remove("dn")}catch(l){console.log(l)}finally{A.hide()}}),500)});let r=s.querySelector("#title"),n=r.value,o=Y.isTitleValid(n);r.addEventListener("input",()=>{n=r.value,o=Y.isTitleValid(n)});let d=s.querySelector("#description"),c=s.querySelector("#description-len"),g=d.value;c.textContent=(350-g.length).toString(),d.addEventListener("input",()=>{g=d.value,c.textContent=(350-g.length).toString()});let u=s.querySelector("#keywords"),h=s.querySelector("#preview-keywords"),v=Y.catchKeywords(u.value),f=()=>{h.innerHTML="",v.forEach(l=>{let b=document.createElement("span");b.textContent=l,b.title=l,h.appendChild(b)})};u.addEventListener("input",()=>{v=Y.catchKeywords(u.value),f()}),f();let L=()=>T(this,null,function*(){A.show();try{if(!o){S.alert(r.dataset.message),r.scrollIntoView(),C.shake(r);return}if(v.length<1){S.alert(u.dataset.message),u.scrollIntoView(),C.shake(u);return}let l=new FormData;l.set("title",n),l.set("description",g||""),l.set("keywords",v.join(",")),l.set("image",a);let b=yield fetch("/api/quiz",{body:l,credentials:"include",method:"POST"});if(b.status===403)return ne();let H=yield b.json();b.ok?window.location.href=H.url:S.danger(H.message)}catch(l){console.log(l)}finally{A.hide()}});s.addEventListener("submit",l=>{l.preventDefault(),L()}),we()}function we(){var B,J;let s=document.getElementById("preview-quests"),e=document.getElementById("quiz-slug").dataset.value,t=document.querySelector("#button-add-new-quest"),i=document.getElementById("add-quest-modal"),a=i.querySelector("form"),r=[i.querySelector("#hide-form-add-quest"),i.querySelector("button.danger")],n=i.querySelector("#quest-image-preview"),o=i.querySelector("#quest-image-input"),d=i.querySelector("#quest-quest"),c=a.querySelector("#alternative-a"),g=a.querySelector("#alternative-b"),u=a.querySelector("#alternative-c"),h=a.querySelector("#alternative-d"),v=a.querySelector("#alternative-e"),f="",L=null;t.addEventListener("click",()=>{i.style.display="",setTimeout(()=>i.classList.remove("out-right"),10)}),i.addEventListener("click",({target:m})=>{m.id===i.id&&a.dataset.updateQuest==="true"&&(a.dataset.updateQuest="false",l(),r[0].click())}),r.forEach(m=>m.addEventListener("click",()=>{i.classList.add("out-right"),setTimeout(()=>i.style.display="none",500)})),n.addEventListener("click",()=>o.click()),o.addEventListener("input",()=>{A.show(),setTimeout(()=>T(this,null,function*(){try{if(!o.files||!o.files[0])return;let m=yield me.imageToBlobWhithoutResize(o.files[0]);if(!m)return S.alert("Oopss...");if(m.size>1024e3){S.danger(o.dataset.message);return}URL.revokeObjectURL(f),f=URL.createObjectURL(m),n.src=f,L=m}catch(m){console.log(m)}finally{A.hide()}}),500)});function l(){[c,g,u,h,v].forEach(m=>m.value=""),L=null,o.value="",d.value="",n.src=n.dataset.defaultSrc}let b=()=>{d.value=Y.normalizeQuestTitle(d.value)};d.addEventListener("input",b),a.addEventListener("submit",m=>T(this,null,function*(){m.preventDefault();let p=!1;A.show();try{let y=d.value;if(!Y.isQuestTitleValid(y))return S.danger(d.dataset.message),C.shake(d),p=!0;let E=[u,h,v];if(c.value.length<1)return S.danger(c.dataset.message),C.shake(c),p=!0;if(g.value.length<1){let K=E.filter(he=>he.value.length>=1);if(K.length>0)g.value=K[0].value,u.value=h.value?h.value:"",h.value=v.value?v.value:"",v.value="";else return S.danger(g.dataset.message),C.shake(g),p=!0}let w=new FormData;w.set("quest",d.value),L&&w.set("image",L),w.set("a",c.value?c.value:""),w.set("b",g.value?g.value:""),w.set("c",u.value?u.value:""),w.set("d",h.value?h.value:""),w.set("e",v.value?v.value:"");let M=yield fetch(`/api/quiz/${e}/quest`,{body:w,credentials:"include",method:"POST"});if(M.status===403)return p=!0,ne();if(M.ok){S.info(a.dataset.success);let K=yield M.json();F(K,s.querySelector(".items")),setTimeout(()=>r[0].click(),500)}else{let K=yield M.json();S.danger(K.message),p=!0}}catch(y){p=!0,console.log(p)}finally{A.hide(),p||l()}}));let H=document.querySelectorAll(".preview-item"),_=(B=s.dataset.delete)!=null?B:"",j=(J=s.dataset.deleteSuccess)!=null?J:"";H.forEach(m=>{let p=Number(m.dataset.id),y=Q.find(w=>w.id===p);if(!y)return console.log("Quest error: "+p);m.addEventListener("click",({target:w})=>W(y,w));let E=m.querySelector("button.delete");E.onclick=()=>ee(E,y)});function ee(m,p){return T(this,null,function*(){let y=m.parentElement.parentElement;if(m.dataset.clicked!=="true"){m.dataset.clicked="true",C.shake(y);let M=m.querySelector("i");M.style.color="var(--alert)",S.alert(O(_,p)),setTimeout(()=>{m.dataset.clicked="false",M.style.color="var(--danger-light)"},5e3);return}S.hide(),A.show();let{response:E,json:w}=yield Ee.DELETE("/api/quiz/quest/"+p.id);if(E.status===403)return ne();E.ok?(S.success(j),Q=Q.filter(M=>M.id!=p.id),C.scaleOut(y,()=>{y.remove(),D(s.querySelector(".items"))})):(S.danger(w.message),C.shake(y)),A.hide()})}function O(m,p){return m.replace("#",p.quest)}function F(m,p){Q.push(m),D(p)}function D(m){m.innerHTML="",Q.forEach((E,w)=>{m.appendChild($({htmlType:"div",attributes:[{key:"class",value:"preview-item"}],onClick:M=>W(E,M),children:[{htmlType:"span",value:(w+1).toString()},{htmlType:"span",value:E.quest,attributes:[{key:"class",value:"quest-title"},{key:"style",value:"color: var(--title);"}]},{htmlType:"div",attributes:[{key:"class",value:"buttons"}],children:[{htmlType:"button",onClick:()=>{},children:[{htmlType:"i",attributes:[{key:"class",value:"bi bi-pencil-square"}]}],attributes:[{key:"type",value:"button"},{key:"class",value:"quest-edit"},{key:"data-id",value:E.id.toString()}]},{htmlType:"button",onClick:M=>ee(M,E),children:[{htmlType:"i",attributes:[{key:"class",value:"bi bi-trash3"},{key:"style",value:"color: var(--danger-light)"}]}],attributes:[{key:"type",value:"button"},{key:"class",value:"delete"},{key:"data-id",value:E.id.toString()}]}]}]}))});let p=document.getElementById("preview-small-quest-alert"),y=document.getElementById("no-quest-alert");if(Q.length<1?y==null||y.classList.remove("dn"):y==null||y.classList.add("dn"),Q.length>=5){p.classList.add("dn");return}p.classList.remove("dn"),p.scrollIntoView(),setTimeout(()=>C.shake(p),500)}function W(m,p){var y;p.nodeName.toLocaleLowerCase()==="i"&&((y=p.parentElement)!=null&&y.classList.contains("delete"))||(l(),c.value=m.a,g.value=m.b,u.value=m.c,h.value=m.d,v.value=m.e,d.value=m.quest,n.src=m.imageURL.startsWith("https://")?m.imageURL:n.dataset.defaultSrc,a.dataset.updateQuest="true",t.click())}}(()=>{console.log("This app is written in TypeScript");let s=document.getElementById("www-manager-id");if(!s)return console.error("Manager ID is not defined");switch(s.value){case"session":ce(document.getElementById("session"));break;case"profile":ue();break;case"quiz-create":de(document.getElementById("form-n-quiz"));break;case"quiz-edit":pe(document.getElementById("form-e-quiz"));break;default:break}})();})();
//# sourceMappingURL=dist.min.js.map
