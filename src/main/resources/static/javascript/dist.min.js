"use strict";(()=>{var f=(s,e,t)=>new Promise((i,a)=>{var n=d=>{try{o(t.next(d))}catch(c){a(c)}},r=d=>{try{o(t.throw(d))}catch(c){a(c)}},o=d=>d.done?i(d.value):Promise.resolve(d.value).then(n,r);o((t=t.apply(s,e)).next())});var U=class s{constructor(){}GET(i){return f(this,arguments,function*(e,t=new Headers){let a=yield fetch(this.normalizePath(e),this.optionsWithoutBody(t,"GET"));return{json:yield this.getJson(a),response:a,status:a.status}})}POST(a,n){return f(this,arguments,function*(e,t,i=new Headers){let r=yield fetch(this.normalizePath(e),this.options(t,i,"POST"));return{json:yield this.getJson(r),response:r,status:r.status}})}PUT(a,n){return f(this,arguments,function*(e,t,i=new Headers){let r=yield fetch(this.normalizePath(e),this.options(t,i,"PUT"));return{json:yield this.getJson(r),response:r,status:r.status}})}PATCH(a,n){return f(this,arguments,function*(e,t,i=new Headers){let r=yield fetch(this.normalizePath(e),this.options(t,i,"PATCH"));return{json:yield this.getJson(r),response:r,status:r.status}})}DELETE(i){return f(this,arguments,function*(e,t=new Headers){let a=yield fetch(this.normalizePath(e),this.optionsWithoutBody(t,"DELETE"));if(!a.ok){let n=yield this.getJson(a);return{response:a,status:a.status,json:n}}return{response:a,status:a.status}})}normalizePath(e){return e.startsWith("/api")?e:"/api"+(e.startsWith("/")?e:e+"/")}configureHeaders(e){return e.set("Content-Type","application/json"),e}options(e,t,i="GET"){return{body:e,headers:this.configureHeaders(t),credentials:"include",method:i}}optionsWithoutBody(e,t="GET"){return{headers:this.configureHeaders(e),credentials:"include",method:t}}getJson(e){return e.status!==204&&e.status!==205?e.json():null}static get(){return s.rest||(s.rest=new s),s.rest}};var J=class{constructor(){this.emailRegex=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;this.usernameRegex=/[^a-zA-Z0-9\-_.]/g}isEmailValid(e){return typeof e=="string"&&this.emailRegex.test(e)}isPasswordValid(e){return typeof e=="string"&&e.length>=8}isNameValid(e){return typeof e=="string"&&e.length>=2}isUsernameValid(e){return typeof e=="string"&&e.length>=1}normalizeUsername(e){return e.trim().replace(this.usernameRegex,"")}};var P=class s{constructor(){this.shakeClass="animated-by-shake"}scaleIn(e,t){e.style.scale="1.1",setTimeout(()=>{e.style.scale="",t&&setTimeout(()=>t(),400)},400)}scaleOut(e,t){e.style.scale="1.1",setTimeout(()=>{e.style.scale="0",t&&setTimeout(()=>t(),400)},100)}shake(e,t=!0,i=400){e.classList.contains(this.shakeClass)&&e.classList.remove(this.shakeClass),t&&e.focus(),setTimeout(()=>{e.classList.add(this.shakeClass),setTimeout(()=>e.classList.remove(this.shakeClass),i)},100)}static get(){return s.anim||(s.anim=new s),s.anim}};function ae({htmlType:s,attributes:e,value:t,onClick:i,children:a}){let n=document.createElement(s);return e&&e.forEach(r=>n.setAttribute(r.key,r.value)),i&&(n.onclick=()=>i(n)),a&&a.forEach(r=>{let o=ae(r);n.appendChild(o)}),t&&(n.textContent=t),n}function K({attributes:s,value:e,htmlType:t,onClick:i,children:a}){let n=ae({htmlType:t,attributes:s,onClick:i});return a&&a.forEach(r=>{let o=ae(r);n.appendChild(o)}),e&&(n.textContent=e),n}var x=class s{constructor(){this.screenProgressID="progress-view-container";this.barClassName="bar";this.bar2ClassName="bar2";this.view=K({htmlType:"div",attributes:[{key:"id",value:this.screenProgressID}],children:[{htmlType:"div",attributes:[{key:"class",value:this.barClassName}]},{htmlType:"div",attributes:[{key:"class",value:this.bar2ClassName}]}]});this.isVisible=!1}show(){this.isVisible||(this.isVisible=!0,document.body.appendChild(this.view))}hide(){this.isVisible=!1,this.view.remove()}onScreen(){return this.isVisible}static get(){return s.tool||(s.tool=new s),s.tool}};var M=class s{constructor(e){this.events=[];this.toasterID="toaster";this.toaster=null;this.toasterText=null;this.toasterIcon=null;this.toasterProgress=null;this.styleWithAnim=document.createElement("style");this.toasterInScreen=!1;this.animationClass="ex-anim-progress-bar";this.animationKeyframePropertyName="kf-anim-progress-bar";this.themes={info:{icon:"bi bi-info-circle",backdrop:"var(--primary)",color:"var(--text-on-primary)"},danger:{icon:"bi bi-exclamation-diamond",backdrop:"var(--danger)",color:"var(--text-on-danger)"},alert:{icon:"bi bi-question-diamond",backdrop:"var(--alert)",color:"var(--text-on-alert)"},success:{icon:"bi bi-check2-circle",backdrop:"var(--success)",color:"var(--text-on-success)"}};this.afterFunction=void 0;this.anim=e}generate(){this.toaster=K({htmlType:"div",attributes:[{key:"id",value:this.toasterID}],children:[{htmlType:"div",attributes:[{key:"class",value:"content"}],children:[{htmlType:"i",attributes:[{key:"class",value:"bi bi-info-circle"}]},{htmlType:"span"}]},{htmlType:"div",attributes:[{key:"class",value:"progress "+this.animationClass}]}]}),this.toasterText=this.toaster.querySelector("span"),this.toasterIcon=this.toaster.querySelector("i"),this.toasterProgress=this.toaster.querySelector(".progress"),document.head.appendChild(this.styleWithAnim),this.toaster.onclick=()=>{this.hide()}}updateStyle(e){this.styleWithAnim.innerHTML=`
    .${this.animationClass} {
      animation: ${this.animationKeyframePropertyName} ${e}ms ease;
    }

    @keyframes ${this.animationKeyframePropertyName} {
      to {
        transform: translateX(-100%);
      }
    }
    `}updateTheme({backdrop:e,color:t,icon:i}){var a,n,r;this.toasterIcon.className=i,(a=this.toaster)==null||a.style.setProperty("background",e),(n=this.toasterIcon)==null||n.style.setProperty("color",t),(r=this.toasterText)==null||r.style.setProperty("color",t)}show(e){if(this.toasterInScreen){this.hide().then(()=>this.show(e));return}this.toaster.style.scale="0",this.toasterInScreen=!0,this.toasterProgress.style.transform="",document.body.appendChild(this.toaster),this.events.push(setTimeout(()=>this.anim.scaleIn(this.toaster),100)),this.events.push(setTimeout(()=>this.toasterProgress.style.transform="translateX(-100%)",e-10))}hide(){return f(this,null,function*(){return new Promise(e=>{try{this.events.forEach(t=>clearTimeout(t)),this.anim.scaleOut(this.toaster,()=>{var t;(t=this.toaster)==null||t.remove(),this.toasterInScreen=!1,e(!0)})}catch(t){console.error(t),e(!1)}finally{typeof this.afterFunction=="function"&&this.afterFunction(),this.afterFunction=void 0}})})}addAfterFunction(e){return this.afterFunction=e,this}info(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.info),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}alert(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.alert),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}success(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.success),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}danger(e,t=6e3){this.updateStyle(t),this.updateTheme(this.themes.danger),this.toasterText.textContent=e||"",this.show(t),this.events.push(setTimeout(()=>this.hide(),t))}getAnimator(){return this.anim}static get(e){return s.tool||(e||(e=P.get()),s.tool=new s(e),s.tool.generate()),s.tool}};var re=P.get(),F=M.get(),ie=x.get(),pe=U.get();function oe(s){var g;let e="",t=s.dataset.generic?s.dataset.generic:"Oopss...",i=s.dataset.success?s.dataset.success:"#",a=new J,n=s.querySelector("input#email"),r=n.dataset.message,o=s.querySelector("input#password"),d=o.dataset.message,c=s.querySelector('button[type="submit"]'),h=s.querySelector("#session-sign-up"),u=document.createElement("button");new URLSearchParams(location.search).get("clear")==="true"&&F.danger((g=s.dataset.forbidden)!=null?g:""),n.addEventListener("input",()=>{n.dataset.error=String(!a.isEmailValid(n.value.trim()))}),o.addEventListener("input",()=>{o.dataset.error=String(!a.isPasswordValid(o.value.trim()))}),c.addEventListener("click",v=>{v.preventDefault(),e="/authentication/session",u.click()}),h.addEventListener("click",()=>{e="/authentication/sign-up",u.click()}),s.addEventListener("submit",v=>{if(v.preventDefault(),!a.isEmailValid(n.value.trim())){re.shake(n),F.danger(r);return}if(!a.isPasswordValid(o.value.trim())){re.shake(o),F.danger(d);return}p()});function p(){return f(this,null,function*(){ie.show();try{let v=JSON.stringify({email:n.value.trim(),password:o.value.trim()}),{json:b}=yield pe.POST(e,v);if(!b){F.alert(t);return}if(!b.user){F.alert(b.message);return}F.addAfterFunction(()=>{new URLSearchParams(location.search).get("clear")==="true"?window.close():window.location.href="/"}).success(i.replace("#",b.user.username))}catch(v){console.log(v),F.alert(t)}finally{ie.hide()}})}u.type="submit",u.textContent="Submit",u.classList.add("dn"),s.appendChild(u)}var z=class s{constructor(){}imageToBlob(e,t=128,i=128,a=!0){return new Promise(n=>{try{if(!e)return n(null);let r=URL.createObjectURL(e),o=new Image;o.onload=()=>f(this,null,function*(){let d=o.width,c=o.height,u=document.createElement("canvas").getContext("2d"),p=a&&(d<c?yield this.resizeHeight(o,d,c):d>c?yield this.resizeWidth(o,d,c):o)||o;u.canvas.width=t,u.canvas.height=i,u.drawImage(p,0,0,t,i),u.canvas.toBlob(g=>{URL.revokeObjectURL(r),n(g)},"image/jpeg",.9)}),o.crossOrigin="Anonymous",o.src=r}catch(r){n(null)}})}imageToBlobWhithoutResize(e,t=.85){return(t>1||t<0)&&(t=1),new Promise(i=>{try{if(!e)return i(null);let a=URL.createObjectURL(e),n=new Image;n.onload=()=>f(this,null,function*(){let r=n.width*.8,o=n.height*.8,c=document.createElement("canvas").getContext("2d");c.canvas.width=r,c.canvas.height=o,c.drawImage(n,0,0,r,o),c.canvas.toBlob(h=>{URL.revokeObjectURL(a),i(h)},"image/jpeg",t)}),n.crossOrigin="Anonymous",n.src=a}catch(a){i(null)}})}resizeHeight(e,t,i){return new Promise(a=>{let r=document.createElement("canvas").getContext("2d");r.canvas.width=t,r.canvas.height=t,r.drawImage(e,0,i*.2,t,t,0,0,t,t);let o=new Image;o.onload=()=>a(o),o.src=r.canvas.toDataURL()})}resizeWidth(e,t,i){return new Promise(a=>{let r=document.createElement("canvas").getContext("2d");r.canvas.width=i,r.canvas.height=i,r.drawImage(e,t*.2,0,i,i,0,0,i,i);let o=new Image;o.onload=()=>a(o),o.src=r.canvas.toDataURL()})}static get(){return s.tool||(s.tool=new s),s.tool}};var he=z.get(),S=M.get(),C=P.get(),j=x.get(),ne=U.get(),q=new J;function ge(s){let e=s.dataset.auth,t=document.querySelector("main"),i=document.querySelector("header"),a=s.querySelector("#avatar-input"),n=s.querySelector(".avatar"),r=document.querySelector("header").querySelector(".avatar"),o=a.dataset.message,d=s.querySelector("#span-user-name"),c=s.querySelector(".modal"),h=c.querySelector("button.danger"),u=c.querySelector("button.primary"),p="";t.style.minHeight=`calc(95vh - ${i.clientHeight}px)`,n.addEventListener("click",()=>a.click()),a.addEventListener("input",()=>f(this,null,function*(){j.show();try{if(!a.files||!a.files[0]){S.info(o),C.shake(n);return}let L=yield he.imageToBlob(a.files[0]);if(!L){S.info(o),C.shake(n);return}let T=new FormData;T.set("avatar",L);let w=yield fetch("/api/authentication/user/avatar",{method:"PATCH",body:T,credentials:"include"}),D=yield w.json();w.ok?S.success(D.message):S.danger(D.message),URL.revokeObjectURL(p),p=URL.createObjectURL(L),n.src=p,r.src=p}catch(L){console.log(L)}finally{j.hide()}}));let g=c.querySelector("#password"),v=g.value.trim(),b=q.isPasswordValid(v);g.addEventListener("input",()=>{v=g.value.trim(),b=q.isPasswordValid(v),g.dataset.error=String(!b)});let l=s.querySelector("#name"),I=l.value.trim(),X=q.isNameValid(I);l.addEventListener("input",()=>{I=l.value.trim(),X=q.isNameValid(I),l.dataset.error=String(!X)});let R=s.querySelector("#email"),Y=R.value.trim(),O=Y,N=q.isEmailValid(O);R.addEventListener("input",()=>{O=R.value.trim(),N=q.isEmailValid(O),R.dataset.error=String(!N)});let B=s.querySelector("#username"),W=B.dataset.usernameAlreadyRegistered,m=B.value.trim(),y=q.isUsernameValid(m);B.addEventListener("input",()=>{B.value=q.normalizeUsername(B.value),m=B.value.trim(),y=q.isUsernameValid(m),B.dataset.error=String(!y)}),s.addEventListener("submit",L=>f(this,null,function*(){if(L.preventDefault(),j.show(),!y){S.alert(l.dataset.message);return}if(!N){S.alert(R.dataset.message);return}if(!X){S.alert(l.dataset.message);return}let{status:T,json:w}=yield ne.GET("user/passwordu, JSON.stringify({password, newPassword})sername/"+m);if(T===200&&(w==null?void 0:w.email)!==e&&S.info(W==null?void 0:W.replace("#",m)),Y!==O&&N){c==null||c.classList.remove("out-bottom"),j.hide();return}E()}));function E(L=!1){return f(this,null,function*(){try{let T=L?{email:O,password:v,name:I,username:m}:{name:I,username:m},{json:w,status:D}=yield ne.PUT("/authentication/user",JSON.stringify(T));if(D===200)return S.success(s.dataset.success),d.textContent=w.name,history.pushState(null,"","/u/"+w.username);S.danger(w.message),console.log(w)}catch(T){S.danger("Oopsss..."),console.log(T)}finally{j.hide()}})}h==null||h.addEventListener("click",()=>c.classList.add("out-bottom")),u==null||u.addEventListener("click",()=>{if(!b){S.alert(g.dataset.message),C.shake(g);return}j.show(),E(!0)})}function ve(s,e){e.addEventListener("click",()=>s.classList.remove("out-left"));let t=s.querySelector("button.danger"),i=s.querySelector("form"),a=s.querySelector("#c-password"),n=a.value.trim(),r=q.isPasswordValid(n);a.addEventListener("input",()=>{n=a.value.trim(),r=q.isPasswordValid(n),a.dataset.error=String(!r)});let o=()=>{p=u.value.trim(),u.dataset.error=String(!(h&&c===p))},d=s.querySelector("#n-password"),c=d.value.trim(),h=q.isPasswordValid(c);d.addEventListener("input",()=>{c=d.value.trim(),h=q.isPasswordValid(c),d.dataset.error=String(!h),o()});let u=s.querySelector("#c-n-password"),p=u.value.trim();u.addEventListener("input",o),t==null||t.addEventListener("click",()=>{s.classList.add("out-left")}),i.addEventListener("submit",g=>f(this,null,function*(){g.preventDefault(),j.show();try{if(!r){S.danger(a.dataset.message),C.shake(a);return}if(!h){S.danger(d.dataset.message),C.shake(d);return}if(p!==c){S.danger(u.dataset.message),C.shake(u);return}if(p===n){S.danger(u.dataset.messageEqual),C.shake(u),C.shake(d),C.shake(a);return}let{json:v,status:b}=yield ne.PATCH("/authentication/user/password",JSON.stringify({password:n,newPassword:c}));if(b===204){a.value="",n="",c="",d.value="",p="",u.value="",t==null||t.click(),S.success(i.dataset.success);return}S.danger(v.message)}catch(v){console.log(v)}finally{j.hide()}}))}function le(){let s=document.getElementById("edit-profile");s&&(ge(s),ve(document.getElementById("modal-password"),document.getElementById("button-update-password")))}var G=class{constructor(){this.keywordsRegex=/[^a-zA-Z0-9,_\-@#!%&?*\s]/g}isTitleValid(e){return typeof e=="string"&&e.length>=5}catchKeywords(e){return e?this.normalizeKeywords(e).replace(/,/g," ").split(" ").filter(t=>t.length>=1):[]}normalizeKeywords(e){return typeof e=="string"?e.replace(this.keywordsRegex,"").toLocaleLowerCase():""}isQuestTitleValid(e){return typeof e=="string"&&e.length<=150&&e.length>=5}normalizeQuestTitle(e){return typeof e=="string"?e.replace(/\r\n|\r|\n/g,""):""}};var _=x.get(),ye=z.get(),ee=new G,te=P.get(),$=M.get(te);function ce(s){let e=s.querySelector("#btn-add-f-img"),t=s.querySelector('input[type="file"]'),i=s.querySelector("#image-preview"),a="",n;e.addEventListener("click",()=>t.click()),i.addEventListener("click",()=>t.click()),t.addEventListener("input",()=>{_.show(),setTimeout(()=>f(this,null,function*(){try{if(!t.files||!t.files[0])return;let l=yield ye.imageToBlobWhithoutResize(t.files[0]);if(!l)return $.alert("Oopss...");if(l.size>1024e3){console.log(l.size),$.danger(t.dataset.message);return}URL.revokeObjectURL(a),a=URL.createObjectURL(l),i.src=a,n=l,i.classList.contains("dn")&&(i.classList.remove("dn"),e.classList.add("dn"))}catch(l){console.log(l)}finally{_.hide()}}),500)});let r=s.querySelector("#title"),o=r.value,d=ee.isTitleValid(o);r.addEventListener("input",()=>{o=r.value,d=ee.isTitleValid(o)});let c=s.querySelector("#description"),h=s.querySelector("#description-len"),u=c.value;h.textContent=(350-u.length).toString(),c.addEventListener("input",()=>{u=c.value,h.textContent=(350-u.length).toString()});let p=s.querySelector("#keywords"),g=s.querySelector("#preview-keywords"),v=ee.catchKeywords(p.value);p.addEventListener("input",()=>{v=ee.catchKeywords(p.value),g.innerHTML="",v.forEach(l=>{let k=document.createElement("span");k.textContent=l,k.title=l,g.appendChild(k)})});let b=()=>f(this,null,function*(){_.show();try{if(!n){$.alert(e.dataset.message),e.classList.contains("dn")||(e.scrollIntoView(),te.shake(e));return}if(!d){$.alert(r.dataset.message),r.scrollIntoView(),te.shake(r);return}if(v.length<1){$.alert(p.dataset.message),p.scrollIntoView(),te.shake(p);return}let l=new FormData;l.set("title",o),l.set("description",u||""),l.set("keywords",v.join(",")),l.set("image",n);let k=yield fetch("/api/quiz",{body:l,credentials:"include",method:"POST"});if(console.log(k),k.status===403){window.open("/session?clear=true","_blank","focus");return}let I=yield k.json();k.ok?window.location.href=I.url:$.danger(I.message)}catch(l){console.log(l)}finally{_.hide()}});s.addEventListener("submit",l=>{l.preventDefault(),b()})}function se(){M.get().hide(),x.get().hide(),M.get().alert("Forbidden (403)"),window.open("/session?clear=true","_blank","focus")}var V=x.get(),ue=z.get(),Z=new G,A=P.get(),H=M.get(A),fe=U.get(),Q=typeof listOfQuests!="undefined"?listOfQuests:[];function de(s){let e=s.querySelector('input[type="file"]'),t=s.querySelector("#image-preview"),i="",a;t.addEventListener("click",()=>e.click()),e.addEventListener("input",()=>{V.show(),setTimeout(()=>f(this,null,function*(){try{if(!e.files||!e.files[0])return;let l=yield ue.imageToBlobWhithoutResize(e.files[0]);if(!l)return H.alert("Oopss...");if(l.size>1024e3){H.danger(e.dataset.message);return}URL.revokeObjectURL(i),i=URL.createObjectURL(l),t.src=i,a=l,t.classList.contains("dn")&&t.classList.remove("dn")}catch(l){console.log(l)}finally{V.hide()}}),500)});let n=s.querySelector("#title"),r=n.value,o=Z.isTitleValid(r);n.addEventListener("input",()=>{r=n.value,o=Z.isTitleValid(r)});let d=s.querySelector("#description"),c=s.querySelector("#description-len"),h=d.value;c.textContent=(350-h.length).toString(),d.addEventListener("input",()=>{h=d.value,c.textContent=(350-h.length).toString()});let u=s.querySelector("#keywords"),p=s.querySelector("#preview-keywords"),g=Z.catchKeywords(u.value),v=()=>{p.innerHTML="",g.forEach(l=>{let k=document.createElement("span");k.textContent=l,k.title=l,p.appendChild(k)})};u.addEventListener("input",()=>{g=Z.catchKeywords(u.value),v()}),v();let b=()=>f(this,null,function*(){V.show();try{if(!o){H.alert(n.dataset.message),n.scrollIntoView(),A.shake(n);return}if(g.length<1){H.alert(u.dataset.message),u.scrollIntoView(),A.shake(u);return}let l=new FormData;l.set("title",r),l.set("description",h||""),l.set("keywords",g.join(",")),l.set("image",a);let k=yield fetch("/api/quiz",{body:l,credentials:"include",method:"POST"});if(k.status===403)return se();let I=yield k.json();k.ok?window.location.href=I.url:H.danger(I.message)}catch(l){console.log(l)}finally{V.hide()}});s.addEventListener("submit",l=>{l.preventDefault(),b()}),Te()}function Te(){var B,W;let s=document.getElementById("preview-quests"),e=document.getElementById("quiz-slug").dataset.value,t=document.querySelector("#button-add-new-quest"),i=document.getElementById("add-quest-modal"),a=i.querySelector("form"),n=[i.querySelector("#hide-form-add-quest"),i.querySelector("button.danger")],r=i.querySelector("#quest-image-preview"),o=i.querySelector("#quest-image-input"),d=i.querySelector("#quest-quest"),c=a.querySelector("#alternative-a"),h=a.querySelector("#alternative-b"),u=a.querySelector("#alternative-c"),p=a.querySelector("#alternative-d"),g=a.querySelector("#alternative-e"),v="",b=null;t.addEventListener("click",()=>{i.style.display="",setTimeout(()=>i.classList.remove("out-right"),10)}),n.forEach(m=>m.addEventListener("click",()=>{i.classList.add("out-right"),setTimeout(()=>i.style.display="none",500)})),r.addEventListener("click",()=>o.click()),o.addEventListener("input",()=>{V.show(),setTimeout(()=>f(this,null,function*(){try{if(!o.files||!o.files[0])return;let m=yield ue.imageToBlobWhithoutResize(o.files[0]);if(!m)return H.alert("Oopss...");if(m.size>1024e3){H.danger(o.dataset.message);return}URL.revokeObjectURL(v),v=URL.createObjectURL(m),r.src=v,b=m}catch(m){console.log(m)}finally{V.hide()}}),500)});let l=()=>{d.value=Z.normalizeQuestTitle(d.value)};d.addEventListener("input",l),a.addEventListener("submit",m=>f(this,null,function*(){m.preventDefault();let y=!1;V.show();try{let E=d.value;if(!Z.isQuestTitleValid(E))return H.danger(d.dataset.message),A.shake(d),y=!0;let L=[u,p,g];if(c.value.length<1)return H.danger(c.dataset.message),A.shake(c),y=!0;if(h.value.length<1){let D=L.filter(me=>me.value.length>=1);if(D.length>0)h.value=D[0].value,u.value=p.value?p.value:"",p.value=g.value?g.value:"",g.value="";else return H.danger(h.dataset.message),A.shake(h),y=!0}let T=new FormData;T.set("quest",d.value),b&&T.set("image",b),T.set("a",c.value?c.value:""),T.set("b",h.value?h.value:""),T.set("c",u.value?u.value:""),T.set("d",p.value?p.value:""),T.set("e",g.value?g.value:"");let w=yield fetch(`/api/quiz/${e}/quest`,{body:T,credentials:"include",method:"POST"});if(w.status===403)return y=!0,se();if(w.ok){H.info(a.dataset.success);let D=yield w.json();O(D,s.querySelector(".items")),setTimeout(()=>n[0].click(),500)}else{let D=yield w.json();H.danger(D.message),y=!0}}catch(E){y=!0,console.log(y)}finally{V.hide(),y||([c,h,u,p,g].forEach(E=>E.value=""),b=null,o.value="",d.value="",r.src=r.dataset.defaultSrc)}}));let k=document.querySelectorAll(".preview-item"),I=(B=s.dataset.delete)!=null?B:"",X=(W=s.dataset.deleteSuccess)!=null?W:"";k.forEach(m=>{let y=Number(m.dataset.id),E=Q.find(T=>T.id===y);if(!E)return console.log("Quest error: "+y);let L=m.querySelector("button.delete");L.onclick=()=>R(L,E)});function R(m,y){return f(this,null,function*(){let E=m.parentElement.parentElement;if(m.dataset.clicked!=="true"){m.dataset.clicked="true",A.shake(E);let w=m.querySelector("i");w.style.color="var(--alert)",H.alert(Y(I,y)),setTimeout(()=>{m.dataset.clicked="false",w.style.color="var(--danger-light)"},5e3);return}H.hide(),V.show();let{response:L,json:T}=yield fe.DELETE("/api/quiz/quest/"+y.id);if(L.status===403)return se();L.ok?(H.success(X),Q=Q.filter(w=>w.id!=y.id),A.scaleOut(E,()=>{E.remove(),N(s.querySelector(".items"))})):(H.danger(T.message),A.shake(E)),V.hide()})}function Y(m,y){return m.replace("#",y.quest)}function O(m,y){Q.push(m),N(y)}function N(m){m.innerHTML="",Q.forEach((L,T)=>{m.appendChild(K({htmlType:"div",attributes:[{key:"class",value:"preview-item"}],children:[{htmlType:"span",value:(T+1).toString()},{htmlType:"span",value:L.quest,attributes:[{key:"class",value:"quest-title"},{key:"style",value:"color: var(--title);"}]},{htmlType:"div",attributes:[{key:"class",value:"buttons"}],children:[{htmlType:"button",onClick:()=>{},children:[{htmlType:"i",attributes:[{key:"class",value:"bi bi-eye"}]}],attributes:[{key:"type",value:"button"},{key:"class",value:"view"},{key:"data-id",value:L.id.toString()}]},{htmlType:"button",onClick:w=>R(w,L),children:[{htmlType:"i",attributes:[{key:"class",value:"bi bi-trash3"},{key:"style",value:"color: var(--danger-light)"}]}],attributes:[{key:"type",value:"button"},{key:"class",value:"delete"},{key:"data-id",value:L.id.toString()}]}]}]}))});let y=document.getElementById("preview-small-quest-alert"),E=document.getElementById("no-quest-alert");if(Q.length<1?E==null||E.classList.remove("dn"):E==null||E.classList.add("dn"),Q.length>=5){y.classList.add("dn");return}y.classList.remove("dn"),y.scrollIntoView(),setTimeout(()=>A.shake(y),500)}}(()=>{console.log("This app is written in TypeScript");let s=document.getElementById("www-manager-id");if(!s)return console.error("Manager ID is not defined");switch(s.value){case"session":oe(document.getElementById("session"));break;case"profile":le();break;case"quiz-create":ce(document.getElementById("form-n-quiz"));break;case"quiz-edit":de(document.getElementById("form-e-quiz"));break;default:break}})();})();
//# sourceMappingURL=dist.min.js.map
